<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<title>Dataset</title>
	<meta content='width=device-width, initial-scale=1.0, shrink-to-fit=no' name='viewport' />
	<link rel="icon" href="../../static/assets/img/icon.ico" type="image/x-icon"/>
	
	<!-- Fonts and icons -->
	<script src="../../static/assets/js/plugin/webfont/webfont.min.js"></script>
	<script>
		WebFont.load({
			google: {"families":["Lato:300,400,700,900"]},
			custom: {"families":["Flaticon", "Font Awesome 5 Solid", "Font Awesome 5 Regular", "Font Awesome 5 Brands", "simple-line-icons"], urls: ['../../static/assets/css/fonts.min.css']},
			active: function() {
				sessionStorage.fonts = true;
			}
		});
	</script>

	<!-- CSS Files -->
	<link rel="stylesheet" href="../../static/assets/css/bootstrap.min.css">
	<link rel="stylesheet" href="../../static/assets/css/atlantis.min.css">
</head>
<style>
	.truncated-text {
		display: inline-block;
		max-height: 3em; /* Giới hạn chiều cao hiển thị */
		overflow: hidden;
		text-overflow: ellipsis;
		white-space: wrap; /* Không xuống dòng */
		cursor: pointer;
	}
	
	.full-text {
		display: none;
	}

	#pieChart {
            max-width: 100%;
            max-height: 500px; /* Tăng chiều cao của biểu đồ */
            height: 400px; /* Đảm bảo biểu đồ có kích thước lớn hơn */
            width: 400px;
        }
	</style>
<body>
	<div class="wrapper">
		<div class="main-header">
			<!-- Logo Header -->
			<div class="logo-header" data-background-color="blue">
				
				<a href="{{ '/home' }}" class="logo">
					<img src="../../static/assets/img/logo.svg" alt="navbar brand" class="navbar-brand">
				</a>
				<button class="navbar-toggler sidenav-toggler ml-auto" type="button" data-toggle="collapse" data-target="collapse" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon">
						<i class="icon-menu"></i>
					</span>
				</button>
				<button class="topbar-toggler more"><i class="icon-options-vertical"></i></button>
				<div class="nav-toggle">
					<button class="btn btn-toggle toggle-sidebar">
						<i class="icon-menu"></i>
					</button>
				</div>
			</div>
			<!-- End Logo Header -->

			<!-- Navbar Header -->
			<nav class="navbar navbar-header navbar-expand-lg" data-background-color="blue2">
				
				<div class="container-fluid">
					<div class="collapse" id="search-nav">
						<form class="navbar-left navbar-form nav-search mr-md-3">
							<div class="input-group">
								<div class="input-group-prepend">
									<button type="submit" class="btn btn-search pr-1">
										<i class="fa fa-search search-icon"></i>
									</button>
								</div>
								<label>
									<input type="text" placeholder="Search ..." class="form-control">
								</label>
							</div>
						</form>
					</div>
					<ul class="navbar-nav topbar-nav ml-md-auto align-items-center">
						<li class="nav-item toggle-nav-search hidden-caret">
							<a class="nav-link" data-toggle="collapse" href="#search-nav" role="button" aria-expanded="false" aria-controls="search-nav">
								<i class="fa fa-search"></i>
							</a>
						</li>
						<li class="nav-item dropdown hidden-caret">
							<a class="nav-link" data-toggle="dropdown" href="#" aria-expanded="false">
								<i class="fas fa-layer-group"></i>
							</a>
							<div class="dropdown-menu quick-actions quick-actions-info animated fadeIn">
								<div class="quick-actions-header">
									<span class="title mb-1">Quick Actions</span>
									<span class="subtitle op-8">Shortcuts</span>
								</div>
								<div class="quick-actions-scroll scrollbar-outer">
									<div class="quick-actions-items">
										<div class="row m-0">
											<a class="col-6 col-md-4 p-0" href="#">
												<div class="quick-actions-item">
													<i class="flaticon-file-1"></i>
													<span class="text">Generated Report</span>
												</div>
											</a>
											<a class="col-6 col-md-4 p-0" href="#">
												<div class="quick-actions-item">
													<i class="flaticon-database"></i>
													<span class="text">Create New Database</span>
												</div>
											</a>
											<a class="col-6 col-md-4 p-0" href="#">
												<div class="quick-actions-item">
													<i class="flaticon-pen"></i>
													<span class="text">Create New Post</span>
												</div>
											</a>
											<a class="col-6 col-md-4 p-0" href="#">
												<div class="quick-actions-item">
													<i class="flaticon-interface-1"></i>
													<span class="text">Create New Task</span>
												</div>
											</a>
											<a class="col-6 col-md-4 p-0" href="#">
												<div class="quick-actions-item">
													<i class="flaticon-list"></i>
													<span class="text">Completed Tasks</span>
												</div>
											</a>
											<a class="col-6 col-md-4 p-0" href="#">
												<div class="quick-actions-item">
													<i class="flaticon-file"></i>
													<span class="text">Create New Invoice</span>
												</div>
											</a>
										</div>
									</div>
								</div>
							</div>
						</li>
						<li class="nav-item dropdown hidden-caret">
							<a class="dropdown-toggle profile-pic" data-toggle="dropdown" href="#" aria-expanded="false">
								<div class="avatar-sm">
									<img src="../../static/assets/img/admin.png" alt="..." class="avatar-img rounded-circle">
								</div>
							</a>
							<ul class="dropdown-menu dropdown-user animated fadeIn">
								<div class="dropdown-user-scroll scrollbar-outer">
									<li>
										<div class="user-box">
											<div class="avatar-lg"><img src="../../static/assets/img/admin.png" alt="image profile" class="avatar-img rounded"></div>
											<div class="u-text">
												<h4>PhucRiO</h4>
												<p class="text-muted">bphuc682@gmail.com</p><a href="profile.html" class="btn btn-xs btn-secondary btn-sm">View Profile</a>
											</div>
										</div>
									</li>
									<li>
										<div class="dropdown-divider"></div>
										<a class="dropdown-item" href="#">My Profile</a>
										<a class="dropdown-item" href="#">My Balance</a>
										<a class="dropdown-item" href="#">Inbox</a>
										<div class="dropdown-divider"></div>
										<a class="dropdown-item" href="#">Account Setting</a>
										<div class="dropdown-divider"></div>
										<a class="dropdown-item" href="#">Logout</a>
									</li>
								</div>
							</ul>
						</li>
					</ul>
				</div>
			</nav>
			<!-- End Navbar -->
		</div>

		<!-- Sidebar -->
		<div class="sidebar sidebar-style-2">
			<div class="sidebar-wrapper scrollbar scrollbar-inner">
				<div class="sidebar-content">
					<div class="user">
						<div class="avatar-sm float-left mr-2">
							<img src="../../static/assets/img/admin.png" alt="..." class="avatar-img rounded-circle">
						</div>
						<div class="info">
							<a data-toggle="collapse" href="#collapseExample" aria-expanded="true">
								<span>
									PhucRiO
									<span class="user-level">Administrator</span>
									<span class="caret"></span>
								</span>
							</a>
							<div class="clearfix"></div>

							<div class="collapse in" id="collapseExample">
								<ul class="nav">
									<li>
										<a href="#profile">
											<span class="link-collapse">My Profile</span>
										</a>
									</li>
									<li>
										<a href="#edit">
											<span class="link-collapse">Edit Profile</span>
										</a>
									</li>
									<li>
										<a href="#settings">
											<span class="link-collapse">Settings</span>
										</a>
									</li>
								</ul>
							</div>
						</div>
					</div>
					<ul class="nav nav-primary">
						<li class="nav-item">
							<a  href="{{ '/home' }}" class="collapsed" aria-expanded="false">
								<i class="fas fa-home"></i>
								<p>Analysis board</p>
								<span class="caret"></span>
							</a>
						<li class="nav-item active">
							<a href="{{ '/dataset' }}">
								<i class="fas fa-table"></i>
								<p>Dataset</p>
								<span class="caret"></span>
							</a>
						</li>
						<li class="nav-item">
							<a href="{{ '/learning_board' }}">
								<i class="far fa-chart-bar"></i>
								<p>Learning board</p>
								<span class="caret"></span>
							</a>
						</li>
						<li class="nav-item">
							<a href="{{ '/model' }}">
								<i class="fas fa-desktop"></i>
								<p>Models</p>
								<span class="caret"></span>
							</a>
						</li>
					</ul>
				</div>
			</div>
		</div>
		<!-- End Sidebar -->

		<div class="main-panel">
			<div class="content">
				<div class="page-inner">
					<div class="page-header">
						<h4 class="page-title">Dataset</h4>
						<ul class="breadcrumbs">
							<li class="nav-home">
								<a href="#">
									<i class="flaticon-home"></i>
								</a>
							</li>
							<li class="separator">
								<i class="flaticon-right-arrow"></i>
							</li>
							<li class="nav-item">
								<a href="#">Tables</a>
							</li>
							<li class="separator">
								<i class="flaticon-right-arrow"></i>
							</li>
							<li class="nav-item">
								<a href="#">Datatables</a>
							</li>
						</ul>
					</div>
					<div class="row">
						<div class="col-md-12">
							<div class="card">
								<div class="card-header">
									<div class="d-flex justify-content-between align-items-center">
										<!-- Left aligned title -->
										<h4 class="card-title">Basic</h4>
					
										<!-- Right aligned upload form -->
										<form action="{{ url_for('view_dataset') }}" method="POST" enctype="multipart/form-data" class="d-flex align-items-center">
											<label for="file" class="mr-2">Upload Dataset CSV File:</label>
											<input type="file" name="file" id="file" accept=".csv" required class="form-control-file mr-2">
											<button type="submit" class="btn btn-primary">Upload</button>
										</form>
									</div>
								</div>
					
								<div class="card-body">
									<!-- Form to change limit -->
									<form method="GET" action="{{ url_for('view_dataset') }}" class="form-inline mb-2">
										<label for="limit" class="mr-2">Max samples:</label>
										<select name="limit" id="limit" class="form-control mr-2" onchange="updateLimitText()">
											<option value="5000" {% if limit == 5000 %}selected{% endif %}>5000</option>
											<option value="1000" {% if limit == 1000 %}selected{% endif %}>1000</option>
											<option value="500" {% if limit == 500 %}selected{% endif %}>500</option>
											<option value="100" {% if limit == 100 %}selected{% endif %}>100</option>
											<option value="50" {% if limit == 50 %}selected{% endif %}>50</option>
										</select>
										<button type="submit" class="btn btn-primary">Apply</button>
									</form>
									
					
									<div class="table-responsive">
										<table id="basic-datatables" class="display table table-striped table-hover">
											<thead>
												<tr>
													<!-- Dynamically generate column headers based on dataset keys -->
													{% if dataset %}
														{% for key in dataset[0].keys() %}
															<th>{{ key }}</th>
														{% endfor %}
													{% endif %}
												</tr>
											</thead>
											<tbody>
												{% if dataset %}
													{% for row in dataset %}
														<tr>
															{% for key, value in row.items() %}
																<td>
																	{% if key == 'Sentence' %}
																		<span class="truncated-text" onclick="toggleText(this)">
																			{{ value }}
																		</span>
																		<span class="full-text">
																			{{ value }}
																		</span>
																	{% else %}
																		{{ value }}
																	{% endif %}
																</td>
															{% endfor %}
														</tr>
													{% endfor %}
												{% else %}
													<tr>
														<td colspan="100%">There is no data to display.</td>
													</tr>
												{% endif %}
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>

						<div class="col-md-12">
							<div class="card">
								<div class="card-header">
									<h4 class="card-title">Dataset Visualization</h4>
								</div>
								<div class="card-body">
									<p>Total: <span id="total-records"></span></p>  <!-- Update this line -->
									<canvas id="pieChart"></canvas>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<footer class="footer">
				<div class="container-fluid">
					<nav class="pull-left">
						<ul class="nav">
							<li class="nav-item">
								<a class="nav-link" href="#">
									PhucRiO
								</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="#">
									Help
								</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="#">
									Licenses
								</a>
							</li>
						</ul>
					</nav>
					<div class="copyright ml-auto">
						2024
					</div>				
				</div>
			</footer>
		</div>
	</div>
	<!--   Core JS Files   -->
	<script src="../../static/assets/js/core/jquery.3.2.1.min.js"></script>
	<script src="../../static/assets/js/core/popper.min.js"></script>
	<script src="../../static/assets/js/core/bootstrap.min.js"></script>
	<!-- jQuery UI -->
	<script src="../../static/assets/js/plugin/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>
	<script src="../../static/assets/js/plugin/jquery-ui-touch-punch/jquery.ui.touch-punch.min.js"></script>
	
	<!-- jQuery Scrollbar -->
	<script src="../../static/assets/js/plugin/jquery-scrollbar/jquery.scrollbar.min.js"></script>
	<!-- Datatables -->
	<script src="../../static/assets/js/plugin/datatables/datatables.min.js"></script>
	<!-- Atlantis JS -->
	<script src="../../static/assets/js/atlantis.min.js"></script>
	<script >
		$(document).ready(function() {
			$('#basic-datatables').DataTable({
			});

			$('#multi-filter-select').DataTable( {
				"ieLength": 5,
				initComplete: function () {
					this.api().columns().every( function () {
						var column = this;
						var select = $('<select class="form-control"><option value=""></option></select>')
						.appendTo( $(column.footer()).empty() )
						.on( 'change', function () {
							var val = $.fn.dataTable.util.escapeRegex(
								$(this).val()
								);

							column
							.search( val ? '^'+val+'$' : '', true, false )
							.draw();
						} );

						column.data().unique().sort().each( function ( d, j ) {
							select.append( '<option value="'+d+'">'+d+'</option>' )
						} );
					} );
				}
			});
			

			// Add Row
			$('#add-row').DataTable({
				"pageLength": 5,
			});

			var action = '<td> <div class="form-button-action"> <button type="button" data-toggle="tooltip" title="" class="btn btn-link btn-primary btn-lg" data-original-title="Edit Task"> <i class="fa fa-edit"></i> </button> <button type="button" data-toggle="tooltip" title="" class="btn btn-link btn-danger" data-original-title="Remove"> <i class="fa fa-times"></i> </button> </div> </td>';

			$('#addRowButton').click(function() {
				$('#add-row').dataTable().fnAddData([
					$("#addName").val(),
					$("#addPosition").val(),
					$("#addOffice").val(),
					action
					]);
				$('#addRowModal').modal('hide');

			});
		});

		
	</script>

	<script>
		function toggleText(element) {
			const fullText = element.nextElementSibling;
			const isTruncated = element.style.display !== 'none';
		
			if (isTruncated) {
				element.style.display = 'none';
				fullText.style.display = 'inline'; // Hiển thị văn bản đầy đủ
			} else {
				element.style.display = 'inline'; // Hiển thị văn bản đã cắt
				fullText.style.display = 'none';
			}
		}
	</script>
	<script>
		function updateLimitText() {
			const limitSelect = document.getElementById('limit');
			const selectedOption = limitSelect.options[limitSelect.selectedIndex].text; // Lấy văn bản của tùy chọn đã chọn
			limitSelect.setAttribute('data-placeholder', 'Limit: ' + selectedOption); // Cập nhật placeholder
		}
		
		// Đặt giá trị mặc định cho placeholder khi tải trang
		window.onload = function() {
			updateLimitText(); // Gọi hàm để cập nhật placeholder ngay khi trang được tải
		};
	</script>

	<script src="../../static/assets/js/plugin/chart.js/chart.min.js"></script>
	<script>
		// Load Pie Chart
		async function loadPieChartData() {
			const response = await fetch('/get_dataset_data');
			const data = await response.json();
			console.log(data);

			// Display total records
			document.getElementById('total-records').innerText = data.total_records;  // Update total records

			var pieChart = document.getElementById('pieChart').getContext('2d');
			var myPieChart = new Chart(pieChart, {
				type: 'pie',
				data: {
					datasets: [{
						data: [data.label_counts.XSS, data.label_counts.Normal],  // Update with correct keys
						backgroundColor: ["#58FF58","#f3545d"],
						borderWidth: 0
					}],
					labels: ['Normal','XSS']
				},
				options: {
					responsive: true,
					maintainAspectRatio: false,
					legend: {
						position: 'bottom',
						labels: {
							fontColor: 'black',
							fontSize: 16,
							usePointStyle: true,
							padding: 20
						}
					},
					pieceLabel: {
						render: 'percentage',
						fontColor: 'white',
						fontSize: 15,
					},
					tooltips: false,
					layout: {
						padding: {
							left: 0,
							right: 0,
							top: 0,
							bottom: 0
						}
					}
				}
			});
		}
		loadPieChartData();
	</script>

</body>
</html>